<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>MindKeep</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!--
    MindKeep Desktop Application - Main UI Structure

    This HTML file defines the complete user interface for MindKeep,
    including all modals, panels, and interactive elements.

    Key Sections:
    - App Header: Title, search, theme selector, action buttons
    - Main Content: Sidebar (categories/notes) and content area
    - Modals: Various dialogs for settings, import/export, etc.
    - Text Editor: Rich text editing interface
    -->

    <div class="app">
        <!-- Application Header with branding and main controls -->
        <div class="app-header">
            <!-- Clickable logo that refreshes the application -->
            <h1 onclick="location.reload()" style="cursor: pointer;" title="Refresh App">
            <span class="brain-animation">🧠</span> MindKeep
            </h1>
            <div class="search-bar">
                <input type="text" id="searchInput" placeholder="Try: #tag, date:2024, category:work" class="search-input">
                <button id="advancedSearchBtn" onclick="toggleAdvancedSearch()" class="advanced-search-btn" title="Advanced Search">🔍</button>
            </div>

            <button class="mobile-menu-btn" onclick="toggleMobileMenu()" title="Menu">
                <span class="hamburger"></span>
                <span class="hamburger"></span>
                <span class="hamburger"></span>
            </button>

            <div class="header-controls" id="headerControls">

                <div class="theme-selector-container">
                    <select id="themeSelector" class="theme-selector" onchange="themeManager.applyTheme(this.value)" title="Select theme">
                        <option value="dark">🌙 Dark</option>
                        <option value="light">☀️ Light</option>
                        <option value="blue">🌊 Ocean Blue</option>
                        <option value="purple">🔮 Purple Haze</option>
                        <option value="green">🌲 Forest Green</option>
                    </select>
                </div>
                <div class="header-menu">
                    <button id="menuBtn" class="header-btn menu-toggle" onclick="toggleMenu()" title="Menu">
                        <span class="btn-icon">☰</span>
                        <span class="btn-text">Menu</span>
                    </button>
                    <div id="headerMenu" class="header-dropdown" style="display: none;">
                        <div class="menu-section">
                            <div class="menu-section-title">Organization</div>
                            <button class="menu-item" onclick="showTagManager(); closeMenu()">
                                <span class="menu-icon">🏷️</span>
                                <span class="menu-text">Tag Manager</span>
                            </button>
                        </div>
                        <div class="menu-divider"></div>
                        <div class="menu-section">
                            <div class="menu-section-title">Data Management</div>
                            <button class="menu-item" onclick="showExportModal(); closeMenu()">
                                <span class="menu-icon">📤</span>
                                <span class="menu-text">Export Notes</span>
                            </button>
                            <button class="menu-item" onclick="showBackupModal(); closeMenu()">
                                <span class="menu-icon">💾</span>
                                <span class="menu-text">Backup & Restore</span>
                            </button>
                        </div>
                        <div class="menu-divider"></div>
                        <div class="menu-section">
                            <div class="menu-section-title">Application</div>
                            <button class="menu-item" onclick="checkForUpdates(); closeMenu()">
                                <span class="menu-icon">🔄</span>
                                <span class="menu-text">Check Updates</span>
                            </button>
                            <button class="menu-item" onclick="showSettings(); closeMenu()">
                                <span class="menu-icon">⚙️</span>
                                <span class="menu-text">Settings</span>
                            </button>
                            <button class="menu-item" onclick="showAbout(); closeMenu()">
                                <span class="menu-icon">ℹ️</span>
                                <span class="menu-text">About</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Navigation Tabs -->
        <div class="main-tabs">
            <button id="notesTab" class="main-tab active" onclick="showNotesView()">
                <span class="tab-icon">📝</span>
                <span class="tab-text">Notes</span>
            </button>
            <button id="tasksTab" class="main-tab" onclick="showTasksView()">
                <span class="tab-icon">✅</span>
                <span class="tab-text">Tasks</span>
            </button>
        </div>

        <!-- Notes View -->
        <div id="notesView" class="main-view active">
            <div class="app-body">
            <div class="sidebar">
                <div class="sidebar-header">
                    <div class="categories-tree" id="categoriesTree">
                        <div class="category-item root-category active" onclick="selectCategory('all')">
                            <span class="category-icon">📁</span>
                            <span class="category-name">All Notes</span>
                            <span class="note-count">0</span>
                        </div>
                    </div>
                    <div class="sidebar-controls">
                        <div class="category-actions">
                            <button class="category-btn" onclick="createNewCategory()" title="Create Category">
                                <span class="btn-icon">📁</span>
                            </button>
                            <button class="category-btn" onclick="manageCategories()" title="Manage Categories">
                                <span class="btn-icon">⚙️</span>
                            </button>
                        </div>
                        <select id="sortSelector" class="sort-selector" onchange="changeSorting()">
                            <option value="updated_at DESC">Recent</option>
                            <option value="created_at DESC">Created</option>
                            <option value="title ASC">A-Z</option>
                            <option value="title DESC">Z-A</option>
                        </select>
                    </div>
                    <div class="bulk-actions" id="bulkActions" style="display: none;" data-selected-count="0">
                        <div class="bulk-info">
                            <span class="selection-count">0 selected</span>
                            <button class="bulk-exit-btn" onclick="toggleBulkMode()" title="Exit selection mode">✕</button>
                        </div>
                        <div class="bulk-buttons">
                            <button class="bulk-btn delete-btn" onclick="bulkDelete()" title="Delete selected notes">
                                <span class="btn-icon">🗑️</span>
                                <span class="btn-text">Delete</span>
                            </button>
                            <button class="bulk-btn move-btn" onclick="bulkMove()" title="Move selected notes">
                                <span class="btn-icon">📁</span>
                                <span class="btn-text">Move</span>
                            </button>
                            <button class="bulk-btn duplicate-btn" onclick="findDuplicates()" title="Find duplicate notes">
                                <span class="btn-icon">🔍</span>
                                <span class="btn-text">Duplicates</span>
                            </button>
                        </div>
                    </div>
                    <div class="note-actions">
                        <button class="new-note-btn" onclick="createNewNote()" style="display: flex;">
                            <span class="btn-icon">📝</span>
                            <span class="btn-text">New</span>
                        </button>
                        <button class="template-btn" onclick="showTemplateModal()" style="display: flex;">
                            <span class="btn-icon">📋</span>
                            <span class="btn-text">Template</span>
                        </button>
                        <button class="bulk-toggle-btn" onclick="toggleBulkMode()">
                            <span class="btn-icon">☑️</span>
                            <span class="btn-text">Select</span>
                        </button>
                    </div>
                </div>
                <div id="notesList" class="notes-list">
                    <div class="no-notes-message">No notes found</div>
                </div>

            </div>
            
            <div class="main-content">
                <div id="welcomeScreen" class="welcome">
                    <div class="brain-animation-large">🧠</div>
                    <h2>Welcome to MindKeep</h2>
                    <p>Your offline knowledge vault</p>
                </div>
                
                <div id="viewer" class="viewer" style="display: none;">
                    <div class="viewer-header">
                        <h1 id="viewerTitle"></h1>
                        <div class="viewer-actions">
                            <button onclick="editNote()" class="edit-btn">
                                <span class="btn-icon">✏️</span>
                                <span class="btn-text">Edit</span>
                            </button>
                            <button onclick="moveNoteToCategory()" class="move-btn">
                                <span class="btn-icon">📁</span>
                                <span class="btn-text">Move</span>
                            </button>
                            <button onclick="deleteNote()" class="delete-btn">
                                <span class="btn-icon">🗑️</span>
                                <span class="btn-text">Delete</span>
                            </button>
                        </div>
                    </div>
                    <div id="viewerMeta" class="viewer-meta"></div>

                    <div id="viewerContent" class="viewer-content"></div>
                </div>
                
                <div id="editor" class="editor" style="display: none;">
                    <div class="editor-header">
                        <input type="text" id="noteTitle" class="title-input" placeholder="Note title...">
                        <div class="editor-actions">
                            <button onclick="saveCurrentNote()" class="save-btn">Save</button>
                            <button onclick="cancelEdit()" class="cancel-btn">Cancel</button>
                        </div>
                    </div>
                    <div class="editor-body">
                        <select id="noteCategory" class="tags-input">
                            <option value="">Select Category</option>
                        </select>
                        <div class="tag-input-container">
                            <input type="text" id="noteTags" class="tags-input tag-input" placeholder="Tags (e.g., #work #project #important)...">
                            <div id="tagSuggestions" class="tag-suggestions" style="display: none;"></div>
                        </div>
                        <div class="popular-tags">
                            <div id="popularTagsList" class="popular-tags-list"></div>
                        </div>
                        <input type="text" id="noteDescription" class="tags-input" placeholder="Description...">

                        <!-- Task Progress Indicator -->
                        <div id="taskProgress" class="task-progress-container" style="display: none;">
                            <!-- Progress content will be populated by JavaScript -->
                        </div>

                        <div class="editor-toolbar">
                            <button onclick="formatText('bold')" class="toolbar-btn" title="Bold">𝐁</button>
                            <button onclick="formatText('italic')" class="toolbar-btn" title="Italic">𝐼</button>
                            <button onclick="formatText('underline')" class="toolbar-btn" title="Underline">𝐔</button>
                            <button onclick="formatText('strikeThrough')" class="toolbar-btn" title="Strikethrough">𝐒</button>
                            <button onclick="formatHeading('h1')" class="toolbar-btn" title="Heading 1">𝐇₁</button>
                            <button onclick="formatHeading('h2')" class="toolbar-btn" title="Heading 2">𝐇₂</button>
                            <button onclick="formatHeading('h3')" class="toolbar-btn" title="Heading 3">𝐇₃</button>
                            <button onclick="formatText('insertUnorderedList')" class="toolbar-btn" title="Bullet List">⦿</button>
                            <button onclick="formatText('insertOrderedList')" class="toolbar-btn" title="Numbered List">①</button>
                            <button onclick="formatCodeBlock()" class="toolbar-btn" title="Code Block">⧉</button>
                            <button onclick="insertLineBreak()" class="toolbar-btn" title="Section Divider">⸺</button>

                            <button onclick="alignText('left')" class="toolbar-btn" title="Align Left">⬅</button>
                            <button onclick="alignText('center')" class="toolbar-btn" title="Align Center">↔</button>
                            <button onclick="alignText('right')" class="toolbar-btn" title="Align Right">➡</button>
                            <button onclick="undoRedo('undo')" class="toolbar-btn" title="Undo">↶</button>
                            <button onclick="undoRedo('redo')" class="toolbar-btn" title="Redo">↷</button>
                            <div class="toolbar-help">
                                <div class="help-btn">❓</div>
                                <div class="help-tooltip">
                                    <div class="help-item"><strong>𝐁</strong> - Bold text</div>
                                    <div class="help-item"><strong>𝐼</strong> - Italic text</div>
                                    <div class="help-item"><strong>𝐔</strong> - Underline text</div>
                                    <div class="help-item"><strong>𝐒</strong> - Strikethrough text</div>
                                    <div class="help-item"><strong>𝐇₁/𝐇₂/𝐇₃</strong> - Headings</div>
                                    <div class="help-item"><strong>⦿</strong> - Bullet list</div>
                                    <div class="help-item"><strong>①</strong> - Numbered list</div>
                                    <div class="help-item"><strong>⧉</strong> - Code block</div>
                                    <div class="help-item"><strong>⸺</strong> - Section divider</div>
                                    <div class="help-item"><strong>⬅/↔/➡</strong> - Text alignment</div>
                                    <div class="help-item"><strong>↶/↷</strong> - Undo/Redo</div>
                                </div>
                            </div>
                        </div>

                        <div id="noteContent" class="content-editor" contenteditable="true" data-placeholder="Start writing your note..."></div>
                    </div>
                </div>
            </div>
        </div>
        </div> <!-- End Notes View -->

        <!-- Tasks View -->
        <div id="tasksView" class="main-view">
            <div class="tasks-container">
                <div class="tasks-header">
                    <h2>✅ Task Management</h2>
                    <div class="tasks-actions">
                        <button id="newTaskBtn" class="task-btn primary" onclick="showNewTaskModal()">
                            <span class="btn-icon">➕</span>
                            <span class="btn-text">New Task</span>
                        </button>
                        <button id="newTaskListBtn" class="task-btn" onclick="showNewTaskListModal()">
                            <span class="btn-icon">📋</span>
                            <span class="btn-text">New List</span>
                        </button>
                    </div>
                </div>

                <div class="tasks-main">
                    <div class="task-lists-sidebar">
                        <div class="task-lists-header">
                            <h3>Task Lists</h3>
                        </div>
                        <div id="taskLists" class="task-lists">
                            <div class="task-list-item active" data-list-id="default" onclick="selectTaskList('default')">
                                <span class="list-icon">📝</span>
                                <span class="list-name">General Tasks</span>
                                <span class="task-count">0</span>
                            </div>
                        </div>
                    </div>

                    <div class="tasks-content">
                        <div class="tasks-toolbar">
                            <div class="task-filters">
                                <button class="filter-btn active" data-filter="all" onclick="window.filterTasksDirectly('all')">All</button>
                                <button class="filter-btn" data-filter="pending" onclick="window.filterTasksDirectly('pending')">Pending</button>
                                <button class="filter-btn" data-filter="completed" onclick="window.filterTasksDirectly('completed')">Completed</button>
                            </div>
                            <div class="task-sort">
                                <select id="taskSort" onchange="sortTasksGlobal()">
                                    <option value="created">Date Created</option>
                                    <option value="priority">Priority</option>
                                    <option value="alphabetical">Alphabetical</option>
                                    <option value="dueDate">Due Date</option>
                                </select>
                            </div>
                        </div>

                        <div id="tasksContainer" class="tasks-list">
                            <div class="no-tasks-message">
                                <div class="no-tasks-icon">✅</div>
                                <h3>No tasks yet</h3>
                                <p>Create your first task to get started!</p>
                                <button onclick="showNewTaskModal()" class="task-btn primary">
                                    <span class="btn-icon">➕</span>
                                    <span class="btn-text">Create Task</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div> <!-- End Main Views -->

    <!-- Category Modal -->
    <div id="categoryModal" class="modal" style="display: none;">
        <div class="modal-content">
            <h3 id="categoryModalTitle">🎨 Create New Category</h3>
            <input type="text" id="categoryNameInput" placeholder="Category name" class="modal-input">
            <select id="parentCategoryInput" class="modal-input">
                <option value="">No parent (root category)</option>
            </select>

            <div class="category-color-section">
                <label for="categoryColorInput">Category Color:</label>
                <div class="color-picker-container">
                    <input type="color" id="categoryColorInput" value="#4a9eff" class="color-input">
                    <div class="preset-colors">
                        <button type="button" class="preset-color" data-color="#4A9EFF" style="background: #4A9EFF" title="Blue"></button>
                        <button type="button" class="preset-color" data-color="#10B981" style="background: #10B981" title="Green"></button>
                        <button type="button" class="preset-color" data-color="#F59E0B" style="background: #F59E0B" title="Orange"></button>
                        <button type="button" class="preset-color" data-color="#EF4444" style="background: #EF4444" title="Red"></button>
                        <button type="button" class="preset-color" data-color="#8B5CF6" style="background: #8B5CF6" title="Purple"></button>
                        <button type="button" class="preset-color" data-color="#EC4899" style="background: #EC4899" title="Pink"></button>
                        <button type="button" class="preset-color" data-color="#6B7280" style="background: #6B7280" title="Gray"></button>
                        <button type="button" class="preset-color" data-color="#14B8A6" style="background: #14B8A6" title="Teal"></button>
                    </div>
                </div>
            </div>

            <div class="category-templates">
                <label>Quick Templates:</label>
                <div class="template-buttons">
                    <button type="button" class="template-btn" data-template="work">💼 <br> Work</button>
                    <button type="button" class="template-btn" data-template="personal">🏠 Personal</button>
                    <button type="button" class="template-btn" data-template="projects">🚀 Projects</button>
                    <button type="button" class="template-btn" data-template="learning">📚 Learning</button>
                </div>
            </div>
            <div class="modal-buttons">
                <button id="categorySaveBtn" onclick="saveCategoryModal()" class="modal-btn save">Create</button>
                <button onclick="closeCategoryModal()" class="modal-btn cancel">Cancel</button>
            </div>
        </div>
    </div>
    
    <!-- Delete Category Confirmation Modal -->
    <div id="deleteCategoryModal" class="modal" style="display: none;">
        <div class="modal-content delete-category-modal">
            <h3>🗑️ Delete Category</h3>
            <div id="deleteCategoryMessage" class="delete-category-content"></div>
            <div class="modal-buttons">
                <button id="confirmDeleteBtn" class="modal-btn delete-confirm">🗑️ Category</button>
                <button onclick="closeDeleteCategoryModal()" class="modal-btn cancel">Cancel</button>
            </div>
        </div>
    </div>
    
    <!-- Alert Modal -->
    <div id="alertModal" class="modal" style="display: none;">
        <div class="modal-content">
            <h3 id="alertTitle">ℹ️ Information</h3>
            <p id="alertMessage"></p>
            <div class="modal-buttons">
                <button onclick="closeAlert()" class="modal-btn save">OK</button>
            </div>
        </div>
    </div>
    
    <!-- Manage Categories Modal -->
    <div id="manageCategoriesModal" class="modal" style="display: none;">
        <div class="modal-content">
            <h3>⚙️ Manage Categories</h3>
            <div id="categoriesList" class="categories-list"></div>
            <div class="modal-buttons">
                <button onclick="closeManageCategoriesModal()" class="modal-btn cancel">Close</button>
            </div>
        </div>
    </div>
    
    <!-- Move Note Modal -->
    <div id="moveNoteModal" class="modal" style="display: none;">
        <div class="modal-content">
            <h3>📁 Move Note</h3>
            <select id="moveToCategory" class="modal-input">
                <option value="">Select Category</option>
            </select>
            <div class="modal-buttons">
                <button onclick="confirmMoveNote()" class="modal-btn save">Move</button>
                <button onclick="closeMoveNoteModal()" class="modal-btn cancel">Cancel</button>
            </div>
        </div>
    </div>
    
    <!-- Bulk Move Modal -->
    <div id="bulkMoveModal" class="modal" style="display: none;">
        <div class="modal-content">
            <h3>📁 Move Selected Notes</h3>
            <p>Move <span id="selectedCount">0</span> selected notes to:</p>
            <select id="bulkMoveToCategory" class="modal-input">
                <option value="">Select Category</option>
            </select>
            <div class="modal-buttons">
                <button onclick="confirmBulkMove()" class="modal-btn save">Move</button>
                <button onclick="closeBulkMoveModal()" class="modal-btn cancel">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Tag Manager Modal -->
    <div id="tagManagerModal" class="modal" style="display: none;">
        <div class="modal-content tag-manager-content">
            <button class="modal-close" onclick="closeTagManager()">&times;</button>
            <h3>🏷️ Tag Manager</h3>

            <div class="tag-manager-sections">
                <div class="tag-stats-section">
                    <h4>📊 Tag Statistics</h4>
                    <div class="tag-stats">
                        <div class="stat-item">
                            <span class="stat-label">Total Tags:</span>
                            <span id="totalTagsCount" class="stat-value">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Most Used:</span>
                            <span id="mostUsedTag" class="stat-value">-</span>
                        </div>
                    </div>
                </div>

                <div class="all-tags-section">
                    <h4>🏷️ All Tags</h4>
                    <div class="tag-search">
                        <input type="text" id="tagSearchInput" placeholder="Search tags..." class="modal-input">
                    </div>
                    <div id="allTagsList" class="all-tags-list"></div>
                </div>

                <div class="tag-actions-section">
                    <h4>⚡ Quick Actions</h4>
                    <div class="tag-action-buttons">
                        <button onclick="showUnusedTags()" class="modal-btn">Find Unused Tags</button>
                        <button onclick="exportTags()" class="modal-btn">Export Tags</button>
                    </div>
                </div>
            </div>

            <div class="modal-buttons">
                <button onclick="closeTagManager()" class="modal-btn cancel">Close</button>
            </div>
        </div>
    </div>

    <!-- Task Manager Modal -->
    <div id="taskManagerModal" class="modal" style="display: none;">
        <div class="modal-content task-manager-content">
            <button class="modal-close" onclick="closeTaskManager()">&times;</button>
            <h3>📋 Task Dashboard</h3>

            <div class="task-manager-toolbar">
                <div class="task-filters">
                    <select id="taskFilterStatus" class="task-filter-select" onchange="filterTasks()">
                        <option value="all">All Tasks</option>
                        <option value="pending">Pending</option>
                        <option value="completed">Completed</option>
                        <option value="overdue">Overdue</option>
                    </select>
                    <select id="taskFilterPriority" class="task-filter-select" onchange="filterTasks()">
                        <option value="all">All Priorities</option>
                        <option value="high">High Priority</option>
                        <option value="medium">Medium Priority</option>
                        <option value="low">Low Priority</option>
                    </select>
                    <select id="taskFilterCategory" class="task-filter-select" onchange="filterTasks()">
                        <option value="all">All Categories</option>
                    </select>
                </div>
                <div class="task-actions">
                    <button onclick="exportTasks()" class="modal-btn">Export Tasks</button>
                    <button onclick="showTaskHelp()" class="modal-btn">Help</button>
                </div>
            </div>

            <div id="taskDashboard" class="task-dashboard-content">
                <!-- Task content will be populated by JavaScript -->
            </div>

            <div class="modal-buttons">
                <button onclick="closeTaskManager()" class="modal-btn cancel">Close</button>
            </div>
        </div>
    </div>

    <!-- New Task Modal -->
    <div id="newTaskModal" class="modal" style="display: none;">
        <div class="modal-content">
            <button class="modal-close" onclick="closeNewTaskModal()">&times;</button>
            <h3>➕ Create New Task</h3>

            <div class="task-form">
                <input type="text" id="taskTitle" class="modal-input" placeholder="Task title..." maxlength="200">

                <textarea id="taskDescription" class="modal-input" placeholder="Description (optional)..." rows="3"></textarea>

                <div class="task-options">
                    <div class="task-option">
                        <label for="taskPriority">Priority:</label>
                        <select id="taskPriority" class="modal-input">
                            <option value="low">🟢 Low</option>
                            <option value="medium" selected>🟡 Medium</option>
                            <option value="high">🔴 High</option>
                        </select>
                    </div>

                    <div class="task-option">
                        <label for="taskDueDate">Due Date:</label>
                        <input type="date" id="taskDueDate" class="modal-input">
                    </div>

                    <div class="task-option">
                        <label for="taskList">Task List:</label>
                        <select id="taskList" class="modal-input">
                            <option value="default">General Tasks</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="modal-buttons">
                <button onclick="createTask()" class="modal-btn save">Create Task</button>
                <button onclick="closeNewTaskModal()" class="modal-btn cancel">Cancel</button>
            </div>
        </div>
    </div>

    <!-- New Task List Modal -->
    <div id="newTaskListModal" class="modal" style="display: none;">
        <div class="modal-content">
            <button class="modal-close" onclick="closeNewTaskListModal()">&times;</button>
            <h3>📋 Create New Task List</h3>

            <div class="task-list-form">
                <input type="text" id="taskListName" class="modal-input" placeholder="List name..." maxlength="50">

                <div class="task-list-options">
                    <div class="task-option">
                        <label for="taskListIcon">Icon:</label>
                        <select id="taskListIcon" class="modal-input">
                            <option value="📝">📝 General</option>
                            <option value="💼">💼 Work</option>
                            <option value="🏠">🏠 Personal</option>
                            <option value="🛒">🛒 Shopping</option>
                            <option value="🎯">🎯 Goals</option>
                            <option value="📚">📚 Learning</option>
                            <option value="🚀">🚀 Projects</option>
                            <option value="❤️">❤️ Health</option>
                        </select>
                    </div>

                    <div class="task-option">
                        <label for="taskListColor">Color:</label>
                        <div class="color-picker-container">
                            <input type="color" id="taskListColor" value="#4a9eff" class="color-input">
                            <div class="preset-colors">
                                <button type="button" class="preset-color" data-color="#4A9EFF" style="background: #4A9EFF" title="Blue"></button>
                                <button type="button" class="preset-color" data-color="#10B981" style="background: #10B981" title="Green"></button>
                                <button type="button" class="preset-color" data-color="#F59E0B" style="background: #F59E0B" title="Orange"></button>
                                <button type="button" class="preset-color" data-color="#EF4444" style="background: #EF4444" title="Red"></button>
                                <button type="button" class="preset-color" data-color="#8B5CF6" style="background: #8B5CF6" title="Purple"></button>
                                <button type="button" class="preset-color" data-color="#EC4899" style="background: #EC4899" title="Pink"></button>
                                <button type="button" class="preset-color" data-color="#6B7280" style="background: #6B7280" title="Gray"></button>
                                <button type="button" class="preset-color" data-color="#14B8A6" style="background: #14B8A6" title="Teal"></button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal-buttons">
                <button onclick="createTaskList()" class="modal-btn save">Create List</button>
                <button onclick="closeNewTaskListModal()" class="modal-btn cancel">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Edit Task Modal -->
    <div id="editTaskModal" class="modal" style="display: none;">
        <div class="modal-content">
            <button class="modal-close" onclick="closeEditTaskModal()">&times;</button>
            <h3>✏️ Edit Task</h3>

            <div class="task-form">
                <input type="text" id="editTaskTitle" class="modal-input" placeholder="Task title..." maxlength="200">

                <textarea id="editTaskDescription" class="modal-input" placeholder="Description (optional)..." rows="3"></textarea>

                <div class="task-options">
                    <div class="task-option">
                        <label for="editTaskPriority">Priority:</label>
                        <select id="editTaskPriority" class="modal-input">
                            <option value="low">🟢 Low</option>
                            <option value="medium">🟡 Medium</option>
                            <option value="high">🔴 High</option>
                        </select>
                    </div>

                    <div class="task-option">
                        <label for="editTaskDueDate">Due Date:</label>
                        <input type="date" id="editTaskDueDate" class="modal-input">
                    </div>

                    <div class="task-option">
                        <label for="editTaskList">Task List:</label>
                        <select id="editTaskList" class="modal-input">
                            <option value="default">General Tasks</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="modal-buttons">
                <button onclick="updateTask()" class="modal-btn save">Update Task</button>
                <button onclick="closeEditTaskModal()" class="modal-btn cancel">Cancel</button>
            </div>
        </div>
    </div>
    
    <!-- Duplicates Modal -->
    <div id="duplicatesModal" class="modal" style="display: none;">
        <div class="modal-content">
            <h3>🔍 Duplicate Notes</h3>
            <div id="duplicatesList" class="duplicates-list"></div>
            <div class="modal-buttons">
                <button onclick="closeDuplicatesModal()" class="modal-btn cancel">Close</button>
            </div>
        </div>
    </div>
    
    <!-- Confirmation Modal -->
    <div id="confirmModal" class="modal" style="display: none;">
        <div class="modal-content confirm-modal">
            <h3 id="confirmTitle">⚠️ Confirm Action</h3>
            <div id="confirmMessage" class="confirm-content"></div>
            <div class="modal-buttons">
                <button id="confirmYesBtn" class="modal-btn delete-confirm">Confirm</button>
                <button onclick="closeConfirmModal()" class="modal-btn cancel">Cancel</button>
            </div>
        </div>
    </div>
    
    <!-- Update Available Modal -->
    <div id="updateAvailableModal" class="modal" style="display: none;">
        <div class="modal-content">
            <h3>🎉 Update Available!</h3>
            <div class="update-info">
                <div class="version-comparison">
                    <div class="version-item">
                        <span class="version-label">Current Version:</span>
                        <span id="currentVersionText" class="version-number"></span>
                    </div>
                    <div class="version-arrow">→</div>
                    <div class="version-item">
                        <span class="version-label">Latest Version:</span>
                        <span id="latestVersionText" class="version-number"></span>
                    </div>
                </div>
                <div id="updateProgress" class="update-progress" style="display: none;">
                    <div class="progress-bar">
                        <div id="progressFill" class="progress-fill"></div>
                    </div>
                    <div id="progressText" class="progress-text">Downloading...</div>
                </div>
            </div>
            <div class="modal-buttons">
                <button id="installUpdateBtn" onclick="installUpdate()" class="modal-btn save">Install Update</button>
                <button onclick="closeUpdateAvailableModal()" class="modal-btn cancel">Later</button>
            </div>
        </div>
    </div>


    <!-- Advanced Search Modal -->
    <div id="advancedSearchModal" class="modal" style="display: none;">
        <div class="modal-content advanced-search-content">
            <button class="modal-close" onclick="closeAdvancedSearch()">&times;</button>
            <h3>🔍 Advanced Search</h3>
            <div class="search-filters">
                <div class="filter-group">
                    <label>Search in:</label>
                    <div class="checkbox-group">
                        <label><input type="checkbox" id="searchInTitle" checked> Title</label>
                        <label><input type="checkbox" id="searchInContent" checked> Content</label>
                        <label><input type="checkbox" id="searchInTags" checked> Tags</label>
                        <label><input type="checkbox" id="searchInDescription" checked> Description</label>
                    </div>
                </div>
                <div class="filter-group">
                    <label for="searchCategory">Category:</label>
                    <select id="searchCategory" class="modal-input">
                        <option value="">All Categories</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="searchDateFrom">Date Range:</label>
                    <div class="date-range">
                        <input type="date" id="searchDateFrom" class="modal-input">
                        <span>to</span>
                        <input type="date" id="searchDateTo" class="modal-input">
                    </div>
                </div>
                <div class="filter-group">
                    <label for="searchTags">Tags (comma-separated):</label>
                    <input type="text" id="searchTags" placeholder="work, project, important" class="modal-input">
                </div>
                <div class="filter-group">
                    <label><input type="checkbox" id="searchPinnedOnly"> Pinned notes only</label>
                </div>
            </div>
            <div class="modal-buttons">
                <button onclick="performAdvancedSearch()" class="modal-btn save">🔍 Search</button>
                <button onclick="clearAdvancedSearch()" class="modal-btn">🗑️ Clear</button>
                <button onclick="closeAdvancedSearch()" class="modal-btn cancel">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Quick Capture Modal -->
    <div id="quickCaptureModal" class="modal" style="display: none;">
        <div class="modal-content quick-capture-content">
            <button class="modal-close" onclick="closeQuickCapture()">&times;</button>
            <h3>⚡Quick Capture</h3>
            <input type="text" id="quickCaptureTitle" placeholder="Note title..." class="modal-input">
            <select id="quickCaptureCategory" class="modal-input">
                <option value="">Select Category</option>
            </select>

            <div class="tag-input-container">
                <input type="text" id="quickCaptureTags" class="modal-input tag-input" placeholder="Tags (e.g., #work #project #important)...">
                <div id="quickCaptureTagSuggestions" class="tag-suggestions" style="display: none;"></div>
            </div>
            <div class="popular-tags">
                <label>Popular Tags:</label>
                <div id="quickCapturePopularTags" class="popular-tags-list"></div>
            </div>

            <textarea id="quickCaptureContent" placeholder="Start typing your note..." class="quick-capture-textarea"></textarea>
            <div class="modal-buttons">
                <button onclick="saveQuickCapture()" class="modal-btn save">💾 & Close</button>
                <button onclick="saveAndEditQuickCapture()" class="modal-btn">💾 & Edit</button>
                <button onclick="closeQuickCapture()" class="modal-btn cancel">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Floating In-Note Search -->
    <div id="floatingSearch" class="floating-search" style="display: none;">
        <input type="text" id="floatingSearchInput" placeholder="Search in note..." class="floating-search-input">
        <div class="floating-search-controls">
            <button onclick="navigateSearch('prev')" class="floating-nav-btn">↑</button>
            <button onclick="navigateSearch('next')" class="floating-nav-btn">↓</button>
            <span id="floatingSearchResults" class="floating-search-results"></span>
            <button onclick="closeFloatingSearch()" class="floating-close-btn">✕</button>
        </div>
    </div>

    <!-- Template Modal -->
    <div id="templateModal" class="modal" style="display: none;">
        <div class="modal-content template-modal">
            <h3>📋 Templates</h3>
            <div class="template-list" id="templateList">
                <div class="template-item" onclick="createFromTemplate('meeting')">
                    <span class="template-icon">💼</span>
                    <span class="template-name">Meeting Notes</span>
                </div>
                <div class="template-item" onclick="createFromTemplate('daily')">
                    <span class="template-icon">📅</span>
                    <span class="template-name">Daily Journal</span>
                </div>
                <div class="template-item" onclick="createFromTemplate('project')">
                    <span class="template-icon">📁</span>
                    <span class="template-name">Project Plan</span>
                </div>
                <div class="template-item" onclick="createFromTemplate('todo')">
                    <span class="template-icon">✅</span>
                    <span class="template-name">To-Do List</span>
                </div>
                <div class="template-item" onclick="createFromTemplate('research')">
                    <span class="template-icon">🔍</span>
                    <span class="template-name">Research Notes</span>
                </div>
                <div class="template-item" onclick="createFromTemplate('blank')">
                    <span class="template-icon">📄</span>
                    <span class="template-name">Blank Note</span>
                </div>
            </div>
            <div class="modal-buttons">
                <button onclick="showAddTemplateForm()" class="modal-btn save">📋 Add Template</button>
                <button onclick="resetTemplates()" class="modal-btn" style="background: #f39c12;">🔄 Reset Templates</button>
                <button onclick="closeTemplateModal()" class="modal-btn cancel">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Add Template Modal -->
    <div id="addTemplateModal" class="modal" style="display: none;">
        <div class="modal-content">
            <h3>➕ Create Template</h3>
            <input type="text" id="templateNameInput" placeholder="Template name" class="modal-input">
            <input type="text" id="templateIconInput" placeholder="Icon (emoji)" class="modal-input" maxlength="2">
            <input type="text" id="templateTitleInput" placeholder="Note title template" class="modal-input">
            <textarea id="templateContentInput" placeholder="Template content..." class="modal-textarea"></textarea>
            <div class="modal-buttons">
                <button onclick="saveTemplate()" class="modal-btn save">Save Template</button>
                <button onclick="closeAddTemplateModal()" class="modal-btn cancel">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Template Editor Modal -->
    <div id="templateEditorModal" class="modal" style="display: none;">
        <div class="modal-content template-editor-modal">
            <div class="editor-header">
                <input type="text" id="templateEditorName" class="title-input" placeholder="Template name...">
                <div class="editor-actions">
                    <button onclick="saveTemplateEditor()" class="save-btn">Save Template</button>
                    <button onclick="closeTemplateEditor()" class="cancel-btn">Cancel</button>
                </div>
            </div>
            <div class="editor-body">
                <div class="template-meta">
                    <input type="text" id="templateEditorIcon" class="tags-input" placeholder="Icon (emoji)" maxlength="2" style="width: 100px;">
                    <input type="text" id="templateEditorTitle" class="tags-input" placeholder="Note title template (use {date} for current date)..." style="flex: 1; margin-left: 0.5rem;">
                </div>
                <div class="editor-toolbar">
                    <button onclick="formatTemplateText('bold')" class="toolbar-btn"><b>B</b></button>
                    <button onclick="formatTemplateText('italic')" class="toolbar-btn"><i>I</i></button>
                    <button onclick="formatTemplateText('underline')" class="toolbar-btn"><u>U</u></button>
                    <button onclick="formatTemplateHeading('h1')" class="toolbar-btn">H1</button>
                    <button onclick="formatTemplateHeading('h2')" class="toolbar-btn">H2</button>
                    <button onclick="formatTemplateHeading('h3')" class="toolbar-btn">H3</button>
                    <button onclick="formatTemplateText('insertUnorderedList')" class="toolbar-btn">•</button>
                    <button onclick="formatTemplateText('insertOrderedList')" class="toolbar-btn">1.</button>
                    <button onclick="insertTemplatePlaceholder()" class="toolbar-btn" title="Insert {date} placeholder">📅</button>
                </div>
                <div id="templateEditorContent" class="content-editor" contenteditable="true" data-placeholder="Start writing your template content..."></div>
            </div>
        </div>
    </div>

    <!-- Category Context Menu -->
    <div id="categoryContextMenu" class="context-menu" style="display: none;">
        <div class="context-item" onclick="contextEditCategory()">
            <span class="context-icon">✏️</span>
            <span class="context-text">Edit</span>
        </div>
        <div class="context-item" onclick="contextCreateSubcategory()">
            <span class="context-icon">📁</span>
            <span class="context-text">Add Subcategory</span>
        </div>
        <div class="context-separator"></div>
        <div class="context-item context-delete" onclick="contextDeleteCategory()">
            <span class="context-icon">🗑️</span>
            <span class="context-text">Delete</span>
        </div>
    </div>

    <!-- Note Context Menu -->
    <div id="noteContextMenu" class="context-menu" style="display: none;">
        <div class="context-item" onclick="contextEditNote()">
            <span class="context-icon">✏️</span>
            <span class="context-text">Edit</span>
        </div>
        <div class="context-item" onclick="contextMoveNote()">
            <span class="context-icon">📁</span>
            <span class="context-text">Move</span>
        </div>
        <div class="context-item" onclick="contextPinNote()">
            <span class="context-icon">📌</span>
            <span class="context-text">Pin/Unpin</span>
        </div>
        <div class="context-item" onclick="contextExportNote()">
            <span class="context-icon">📤</span>
            <span class="context-text">Export</span>
        </div>
        <div class="context-separator"></div>
        <div class="context-item context-delete" onclick="contextDeleteNote()">
            <span class="context-icon">🗑️</span>
            <span class="context-text">Delete</span>
        </div>
    </div>

    <!-- Enhanced Import/Export Modal -->
    <div id="exportModal" class="modal" style="display: none;">
        <div class="modal-content import-export-modal">
            <h3>📥 Import & Export Notes 📤</h3>

            <div class="import-export-tabs">
                <button class="import-export-tab active" onclick="showImportExportTab('import')">📥 Import Notes</button>
                <button class="import-export-tab" onclick="showImportExportTab('export')">📤 Export Notes</button>
            </div>

            <!-- Import Tab -->
            <div id="importTab" class="import-export-tab-content">
                <div class="import-section">
                    <div class="import-header">
                        <h4>📥 Import Notes</h4>
                        <p>Drag & drop files or click to browse</p>
                    </div>

                    <div class="import-dropzone" id="importDropzone" onclick="document.getElementById('importFileInput').click()">
                        <div class="dropzone-content">
                            <div class="dropzone-icon">📁</div>
                            <div class="dropzone-text">
                                <strong>Drop files here or click to browse</strong>
                                <span>Supports: JSON, Markdown (.md), Text (.txt)</span>
                            </div>
                        </div>
                        <input type="file" id="importFileInput" multiple accept=".json,.md,.txt,.markdown" style="display: none;">
                    </div>

                    <div class="import-options-panel" id="importOptionsPanel" style="display: none;">
                        <div class="import-settings">
                            <div class="setting-group">
                                <label class="setting-label">
                                    <span class="setting-icon">📁</span>
                                    <span>Category:</span>
                                </label>
                                <select id="importCategorySelect" class="setting-select">
                                    <option value="">Select category...</option>
                                </select>
                            </div>

                            <div class="setting-group">
                                <label class="setting-label">
                                    <span class="setting-icon">🏷️</span>
                                    <span>Additional tags:</span>
                                </label>
                                <input type="text" id="importTagsInput" class="setting-input" placeholder="e.g., imported, backup">
                                <small style="color: var(--text-secondary); font-size: 0.75rem; margin-top: 0.25rem; display: block;">
                                    📝 Tags from #hashtags in content will be auto-extracted
                                </small>
                            </div>

                            <div class="setting-group">
                                <label class="setting-checkbox">
                                    <input type="checkbox" id="skipDuplicates" checked>
                                    <span class="checkmark"></span>
                                    <span>Skip duplicates</span>
                                </label>
                            </div>
                        </div>

                        <div class="import-preview" id="importPreview">
                            <h4>📋 Files to Import</h4>
                            <div class="preview-list" id="previewList"></div>
                        </div>

                        <div class="import-actions">
                            <button class="import-btn cancel" onclick="cancelImport()">Cancel</button>
                            <button class="import-btn primary" onclick="startImport()" id="startImportBtn">
                                <span class="btn-icon">📥</span>
                                <span class="btn-text">Import Notes</span>
                            </button>
                        </div>
                    </div>

                    <div class="import-progress" id="importProgress" style="display: none;">
                        <div class="progress-header">
                            <h4>⏳ Importing Notes...</h4>
                            <span class="progress-text" id="progressText">0 of 0 files</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                        <div class="progress-details" id="progressDetails"></div>
                    </div>
                </div>
            </div>

            <!-- Export Tab -->
            <div id="exportTab" class="import-export-tab-content" style="display: none;">
                <div class="export-section">
                    <div class="export-header">
                        <h4>📤 Export Notes</h4>
                        <p>Choose what to export and in which format</p>
                    </div>

                    <div class="export-options">
                        <div class="export-scope-group">
                            <h4>What to export:</h4>
                            <div class="scope-options">
                                <label class="scope-option">
                                    <input type="radio" name="exportScope" value="current" checked>
                                    <span class="scope-icon">📄</span>
                                    <span>Current note</span>
                                </label>
                                <label class="scope-option">
                                    <input type="radio" name="exportScope" value="category">
                                    <span class="scope-icon">📁</span>
                                    <span>Current category</span>
                                </label>
                                <label class="scope-option">
                                    <input type="radio" name="exportScope" value="all">
                                    <span class="scope-icon">📚</span>
                                    <span>All notes</span>
                                </label>
                            </div>
                        </div>

                        <div class="export-format-group">
                            <h4>Export format:</h4>
                            <div class="format-options">
                                <label class="format-option">
                                    <input type="radio" name="exportFormat" value="json" checked>
                                    <span class="format-icon">🔧</span>
                                    <div class="format-info">
                                        <span>JSON</span>
                                        <small>MindKeep format</small>
                                    </div>
                                </label>
                                <label class="format-option">
                                    <input type="radio" name="exportFormat" value="markdown">
                                    <span class="format-icon">📝</span>
                                    <div class="format-info">
                                        <span>Markdown</span>
                                        <small>Universal format</small>
                                    </div>
                                </label>
                                <label class="format-option">
                                    <input type="radio" name="exportFormat" value="text">
                                    <span class="format-icon">📄</span>
                                    <div class="format-info">
                                        <span>Plain Text</span>
                                        <small>Simple format</small>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <div class="export-actions">
                            <button class="export-btn primary" onclick="exportNotes()">
                                <span class="btn-icon">📤</span>
                                <span class="btn-text">Export Notes</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal-buttons">
                <button onclick="closeExportModal()" class="modal-btn cancel">Close</button>
            </div>
        </div>
    </div>

    <!-- Backup Modal -->
    <div id="backupModal" class="modal" style="display: none;">
        <div class="modal-content backup-modal">
            <h3>💾 Backup & Restore</h3>
            <div class="backup-tabs">
                <button class="backup-tab active" onclick="showBackupTab('manage')">Manage Backups</button>
                <button class="backup-tab" onclick="showBackupTab('import')">Import/Export</button>
            </div>

            <div id="backupTabManage" class="backup-tab-content">
                <div class="backup-slots" id="backupSlots">
                    <!-- Backup slots will be populated by JavaScript -->
                </div>
                <div class="backup-actions">
                    <button class="modal-btn save" onclick="createBackup()">Create New Backup</button>
                    <button class="modal-btn cancel" onclick="closeBackupModal()">Close</button>
                </div>
            </div>

            <div id="backupTabImport" class="backup-tab-content" style="display: none;">
                <div class="import-export-section">
                    <h4>Import Backup</h4>
                    <p>Select a backup file to import:</p>
                    <input type="file" id="importFileInput" accept=".json" style="margin: 1rem 0;">
                    <button class="modal-btn save" onclick="importBackupFile()">Import Backup</button>
                </div>
                <div class="import-export-section">
                    <h4>Export Backup</h4>
                    <p>Export a backup slot to file:</p>
                    <select id="exportBackupSlot" style="margin: 1rem 0; padding: 0.5rem;">
                        <option value="">Select backup slot to export</option>
                    </select>
                    <button class="modal-btn save" onclick="exportBackupFile()">Export to File</button>
                </div>
                <div class="backup-actions">
                    <button class="modal-btn cancel" onclick="closeBackupModal()">Close</button>
                </div>
            </div>


        </div>
    </div>

    <!-- Enhanced Confirmation Modal -->
    <div id="confirmationModal" class="modal" style="display: none;">
        <div class="modal-content confirmation-modal">
            <div class="confirmation-icon" id="confirmationIcon">⚠️</div>
            <h3 id="confirmationTitle">Confirm Action</h3>
            <p id="confirmationMessage">Are you sure you want to proceed?</p>
            <div class="confirmation-details" id="confirmationDetails" style="display: none;"></div>
            <div class="modal-buttons">
                <button class="modal-btn save" id="confirmationConfirm">Confirm</button>
                <button class="modal-btn cancel" id="confirmationCancel">Cancel</button>
            </div>
        </div>
    </div>

    <script src="modules/logger.js"></script>
    <script src="modules/performance.js"></script>
    <script src="modules/textEditor.js"></script>
    <script src="modules/export.js"></script>
    <script src="modules/themes.js"></script>
    <script src="renderer.js"></script>
</body>
</html>
