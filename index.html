<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>MindKeep</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="app">
        <div class="app-header">
            <h1>MindKeep</h1>
            <div class="search-bar">
                <input type="text" id="searchInput" placeholder="Search notes..." class="search-input">
            </div>
            <button id="updateBtn" class="update-btn" onclick="window.mindKeep && window.mindKeep.checkForUpdates()">Check Updates</button>
        </div>
        
        <div class="app-body">
            <div class="sidebar">
                <div class="sidebar-header">
                    <select id="categorySelector" class="category-selector">
                        <option value="all">All Notes</option>
                    </select>
                    <div class="category-actions">
                        <button id="newCategoryBtn" class="category-btn" onclick="window.mindKeep && window.mindKeep.createNewCategory()">+ Category</button>
                        <button id="manageCategoriesBtn" class="category-btn" onclick="window.mindKeep && window.mindKeep.manageCategories()">Manage</button>
                    </div>
                    <button id="newNoteBtn" class="new-note-btn" onclick="window.mindKeep && window.mindKeep.createNewNote()">+ New Note</button>
                </div>
                <div id="notesList" class="notes-list"></div>
            </div>
            
            <div class="main-content">
                <div id="welcomeScreen" class="welcome">
                    <h2>Welcome to MindKeep</h2>
                    <p>Your offline knowledge vault</p>
                    <button id="createFirstNote" onclick="window.mindKeep && window.mindKeep.createNewNote()">Create Your First Note</button>
                </div>
                
                <div id="editor" class="editor" style="display: none;">
                    <div class="editor-header">
                        <input type="text" id="noteTitle" class="title-input" placeholder="Note title...">
                        <div class="editor-actions">
                            <button id="saveBtn" class="save-btn">Save</button>
                            <button id="cancelBtn" class="cancel-btn">Cancel</button>
                        </div>
                    </div>
                    <div class="editor-body">
                        <select id="noteCategory" class="tags-input">
                            <option value="">Select Category</option>
                        </select>
                        <input type="text" id="noteTags" class="tags-input" placeholder="Tags (comma separated)...">
                        <input type="text" id="noteDescription" class="tags-input" placeholder="Description...">
                        
                        <div class="toolbar">
                            <select id="fontSelector" class="font-selector" onchange="mindKeep.changeFont(this.value)">
                                <option value="">Font</option>
                                <option value="Arial">Arial</option>
                                <option value="Times New Roman">Times New Roman</option>
                                <option value="Courier New">Courier New</option>
                                <option value="Georgia">Georgia</option>
                                <option value="Verdana">Verdana</option>
                                <option value="Comic Sans MS">Comic Sans MS</option>
                            </select>
                            <button type="button" onclick="document.execCommand('bold')" class="toolbar-btn"><b>B</b></button>
                            <button type="button" onclick="document.execCommand('italic')" class="toolbar-btn"><i>I</i></button>
                            <button type="button" onclick="document.execCommand('underline')" class="toolbar-btn"><u>U</u></button>
                            <button type="button" onclick="document.execCommand('strikeThrough')" class="toolbar-btn"><s>S</s></button>
                            <button type="button" onclick="document.execCommand('insertUnorderedList')" class="toolbar-btn">‚Ä¢ List</button>
                            <button type="button" onclick="document.execCommand('insertOrderedList')" class="toolbar-btn">1. List</button>
                        </div>
                        
                        <div class="editor-container">
                            <div id="noteContent" class="content-editor" contenteditable="true" data-placeholder="Start writing your note..."></div>
                            <div id="imageContainer" class="image-container">
                                <div class="drop-zone-text">Drop images here or paste screenshots</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div id="viewer" class="viewer" style="display: none;">
                    <div class="viewer-header">
                        <h1 id="viewerTitle"></h1>
                        <button id="editBtn" class="edit-btn">Edit</button>
                    </div>
                    <div id="viewerMeta" class="viewer-meta"></div>
                    <div id="viewerTags" class="viewer-tags"></div>
                    <div id="viewerContent" class="viewer-content"></div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Category Modal -->
    <div id="categoryModal" class="modal" style="display: none;">
        <div class="modal-content">
            <h3>Create New Category</h3>
            <input type="text" id="categoryNameInput" placeholder="Category name" class="modal-input">
            <input type="color" id="categoryColorInput" value="#4a9eff" class="modal-input">
            <div class="modal-buttons">
                <button id="saveCategoryBtn" class="modal-btn save">Create</button>
                <button id="closeCategoryBtn" class="modal-btn cancel">Cancel</button>
            </div>
        </div>
    </div>
    
    <!-- Manage Categories Modal -->
    <div id="manageCategoriesModal" class="modal" style="display: none;">
        <div class="modal-content">
            <h3>Manage Categories</h3>
            <div id="categoriesList" class="categories-list"></div>
            <div class="modal-buttons">
                <button id="closeManageCategoriesBtn" class="modal-btn cancel">Close</button>
            </div>
        </div>
    </div>
    
    <!-- Update Available Modal -->
    <div id="updateAvailableModal" class="modal" style="display: none;">
        <div class="modal-content">
            <h3>üéâ Update Available!</h3>
            <p id="updateMessage"></p>
            <div class="modal-buttons">
                <button id="downloadUpdateBtn" class="modal-btn save">Download</button>
                <button id="closeUpdateBtn" class="modal-btn cancel">Later</button>
            </div>
        </div>
    </div>
    
    <!-- No Update Modal -->
    <div id="noUpdateModal" class="modal" style="display: none;">
        <div class="modal-content">
            <h3>‚úÖ You're Up to Date!</h3>
            <p>You have the latest version of MindKeep.</p>
            <div class="modal-buttons">
                <button id="closeNoUpdateBtn" class="modal-btn save">OK</button>
            </div>
        </div>
    </div>
    
    <!-- Update Error Modal -->
    <div id="updateErrorModal" class="modal" style="display: none;">
        <div class="modal-content">
            <h3>‚ùå Update Check Failed</h3>
            <p>Could not check for updates. Please check your internet connection and try again.</p>
            <div class="modal-buttons">
                <button id="closeUpdateErrorBtn" class="modal-btn cancel">OK</button>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
        // Embed the entire app logic here to ensure it works in built versions
        const fs = require('fs');
        const path = require('path');

        class MindKeep {
            constructor() {
                this.notes = [];
                this.categories = [{ name: 'General', color: '#4a9eff' }];
                this.currentNote = null;
                this.currentCategory = 'all';
                this.notesDir = path.join(__dirname, 'notes');
                this.imagesDir = path.join(__dirname, 'images');
                this.categoriesFile = path.join(__dirname, 'categories.json');
                this.init();
            }

            init() {
                this.ensureNotesDir();
                this.loadCategories();
                this.loadNotes();
                this.renderCategories();
                this.renderNotesList();
            }

            ensureNotesDir() {
                if (!fs.existsSync(this.notesDir)) {
                    fs.mkdirSync(this.notesDir, { recursive: true });
                }
                if (!fs.existsSync(this.imagesDir)) {
                    fs.mkdirSync(this.imagesDir, { recursive: true });
                }
            }

            loadCategories() {
                try {
                    if (fs.existsSync(this.categoriesFile)) {
                        const data = fs.readFileSync(this.categoriesFile, 'utf8');
                        this.categories = JSON.parse(data);
                    }
                } catch (error) {
                    console.error('Error loading categories:', error);
                }
            }

            saveCategories() {
                try {
                    fs.writeFileSync(this.categoriesFile, JSON.stringify(this.categories, null, 2));
                } catch (error) {
                    console.error('Error saving categories:', error);
                }
            }

            createNewCategory() {
                document.getElementById('categoryModal').style.display = 'flex';
                document.getElementById('categoryNameInput').focus();
            }

            closeCategoryModal() {
                document.getElementById('categoryModal').style.display = 'none';
                document.getElementById('categoryNameInput').value = '';
                document.getElementById('categoryColorInput').value = '#4a9eff';
            }

            saveCategoryModal() {
                const categoryName = document.getElementById('categoryNameInput').value.trim();
                const color = document.getElementById('categoryColorInput').value;
                
                if (categoryName) {
                    const exists = this.categories.some(cat => cat.name === categoryName);
                    if (!exists) {
                        this.categories.push({ name: categoryName, color: color });
                        this.saveCategories();
                        this.renderCategories();
                        this.closeCategoryModal();
                    } else {
                        alert('Category already exists!');
                    }
                }
            }

            manageCategories() {
                document.getElementById('manageCategoriesModal').style.display = 'flex';
                this.renderCategoriesList();
            }

            closeManageCategoriesModal() {
                document.getElementById('manageCategoriesModal').style.display = 'none';
            }

            renderCategoriesList() {
                const categoriesList = document.getElementById('categoriesList');
                
                categoriesList.innerHTML = this.categories.map(cat => {
                    const noteCount = this.notes.filter(note => note.category === cat.name).length;
                    return `
                        <div class="category-item" style="border-left-color: ${cat.color};">
                            <div class="category-info">
                                <span>${cat.name}</span>
                                <span style="color: #888;">(${cat.color}) - ${noteCount} notes</span>
                            </div>
                            <div class="category-actions">
                                ${noteCount > 0 ? `<button class="category-move" onclick="window.mindKeep.moveNotesFromCategory('${cat.name}')">Move Notes</button>` : ''}
                                ${cat.name !== 'General' ? 
                                    `<button class="category-delete" onclick="window.mindKeep.deleteCategoryFromModal('${cat.name}')">Delete</button>` : 
                                    '<span style="color: #888;">Default</span>'
                                }
                            </div>
                        </div>
                    `;
                }).join('');
            }

            createNewNote() {
                alert('Create new note clicked!');
            }

            checkForUpdates() {
                alert('Check for updates clicked!');
            }

            renderCategories() {
                const categorySelector = document.getElementById('categorySelector');
                const noteCategory = document.getElementById('noteCategory');
                
                if (categorySelector) {
                    categorySelector.innerHTML = '<option value="all">All Notes</option>' + 
                        this.categories.map(cat => `<option value="${cat.name}">${cat.name}</option>`).join('');
                }
                
                if (noteCategory) {
                    noteCategory.innerHTML = '<option value="">Select Category</option>' + 
                        this.categories.map(cat => `<option value="${cat.name}">${cat.name}</option>`).join('');
                }
            }

            loadNotes() {
                this.notes = [];
            }

            renderNotesList() {
                const notesList = document.getElementById('notesList');
                if (notesList) {
                    notesList.innerHTML = '<div style="padding: 1rem; text-align: center; color: #888;">No notes found</div>';
                }
            }
        }

        // Initialize when DOM is ready
        window.mindKeep = null;
        
        function initApp() {
            window.mindKeep = new MindKeep();
            console.log('MindKeep initialized');
        }
        
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initApp);
        } else {
            initApp();
        }
    </script>
</body>
</html>